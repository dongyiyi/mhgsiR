% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnose_mechanism.R
\name{diagnose_mechanism}
\alias{diagnose_mechanism}
\alias{plot.mhgsi_diagnosis}
\title{Diagnose a Symbiotic Mechanism from a Fingerprint}
\usage{
diagnose_mechanism(
  observed_fingerprint,
  reference_library = mhgsiR::reference_fingerprints,
  method = c("cosine", "correlation", "euclidean", "weighted_correlation"),
  allow_rescale = FALSE,
  na_strategy = c("drop_metric", "error"),
  weights = NULL
)

\method{plot}{mhgsi_diagnosis}(x, ...)
}
\arguments{
\item{observed_fingerprint}{A 1-row tibble from `extract_fingerprint()`.}

\item{reference_library}{A data.frame of reference fingerprints. Defaults to `mhgsiR::reference_fingerprints`.}

\item{method}{The similarity metric. Defaults to "cosine".}

\item{allow_rescale}{Logical. If FALSE (default), compares raw values. If TRUE, applies z-score scaling.}

\item{na_strategy}{"drop_metric" (default) drops metrics with NA/NaN/Inf in either side;
"error" stops on any NA/NaN/Inf.}

\item{weights}{Optional numeric vector (only for "weighted_correlation").}
}
\value{
A tibble of class `mhgsi_diagnosis` with columns:
  Mechanism, similarity_score, method, n_metrics, rank, tie_rank.
  Attributes: used_metrics, observed_vector, metric_names_used.
}
\description{
Compare an observed macro‑fingerprint to a library of theoretical archetypes
and rank the best matches.
}
\details{
This is the core inferential function of the mhgsiR package. It takes a
5D fingerprint (e.g., from `extract_fingerprint()`) and computes a
similarity score against each reference fingerprint. The choice of method and
rescaling can influence results, and users are encouraged to test for concordance
across different methods.

### Choosing a Similarity Method:

* **`cosine` (Default):** Measures the orientation (angle) of fingerprint vectors.
  - **Use when:** The relative pattern and direction of effects are most important. Robust for low-dimensional data (≤3 metrics).
  - **Use with caution when:** The absolute magnitude of differences is biologically crucial.

* **`correlation` (Pearson):** Measures the linear relationship of the fingerprint profiles (shape).
  - **Use when:** You care about the "shape" of the profile, and metrics have been rescaled to a comparable range. More robust with ≥4 metrics.
  - **Use with caution when:** The absolute values or magnitudes are biologically meaningful, as this information is weakened by mean-centering.

* **`euclidean`:** Measures the absolute distance between fingerprints in multi-dimensional space.
  - **Use when:** The goal is to find the closest match based on absolute numerical values. Requires metrics to be on a comparable scale (i.e., `allow_rescale = TRUE` is highly recommended).
  - **Use with caution when:** Metrics have vastly different scales and rescaling is turned off, as the metric with the largest scale will dominate the distance.

### Choosing to Rescale (`allow_rescale`):

* **`FALSE` (Default):** Compares raw metric values. Preserves all information about the magnitude of effects.
  - **Recommended for:** Analyzing data from a single, consistent experiment where the scales of the metrics are directly meaningful and comparable.

* **`TRUE`:** Applies a z-score transformation to each metric across all fingerprints being compared.
  - **Recommended for:** Comparing fingerprints from different experiments, studies, or systems where the original scales may not be directly comparable. This focuses the comparison on "shape" rather than "magnitude".
}
